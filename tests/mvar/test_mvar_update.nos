# expect: 0
# Test mvar.update(fn) method for atomic read-modify-write

mvar counter: Int = 0

main() = {
    # Simple update: increment by 1, returns new value
    result1 = counter.update(x => x + 1)
    assert_eq(1, result1)
    assert_eq(1, counter)

    # Another update
    result2 = counter.update(x => x + 10)
    assert_eq(11, result2)
    assert_eq(11, counter)

    # Update that doubles
    result3 = counter.update(x => x * 2)
    assert_eq(22, result3)
    assert_eq(22, counter)

    0
}
