# expect_error: reads mvar `min_val` and later writes it
# Tests that compare-and-set style mvar patterns are detected as unsafe.
# The pattern: read mvar in condition, then conditionally write it.
# This requires atomic compare-and-swap which Nostos doesn't yet support.

mvar min_val: Int = 999999

# This function has the dangerous pattern:
# - reads min_val in condition (naked read)
# - writes min_val = n (non-self-updating write)
update_min(n) = {
    if n < min_val then {
        min_val = n
        true
    } else {
        false
    }
}

main() = 0
