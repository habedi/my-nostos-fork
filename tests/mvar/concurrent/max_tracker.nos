# expect_error: reads mvar `max_val` and later writes it
# Tests that compare-and-set style mvar patterns are detected as unsafe.
# The pattern: read mvar in condition, then conditionally write it.
# This requires atomic compare-and-swap which Nostos doesn't yet support.

mvar max_val: Int = 0

# This function has the dangerous pattern:
# - reads max_val in condition (naked read)
# - writes max_val = n (non-self-updating write)
update_max(n) = {
    if n > max_val then {
        max_val = n
        true
    } else {
        false
    }
}

main() = 0
